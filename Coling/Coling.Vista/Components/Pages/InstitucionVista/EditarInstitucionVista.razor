@page "/institucion/editar/{rowKey}"
@inject IInstitucionService servicioInstitucion
@inject NavigationManager nav
@inject SweetAlertService sweetAlertService

<h3>Editar Institución</h3>

@if (institucion != null)
{
    <EditForm EditContext="contextoEdicion" OnValidSubmit="Editar">
        <DataAnnotationsValidator />
        <div class="mb-3">
            <label>Nombre:</label>
            <div>
                <InputText class="form-control" @bind-Value="@institucion.Nombre" />
                <ValidationMessage For="@(() => institucion.Nombre)" />
            </div>
        </div>

        <div class="mb-3">
            <label>Tipo:</label>
            <div>
                <InputText class="form-control" @bind-Value="@institucion.Tipo" />
                <ValidationMessage For="@(() => institucion.Tipo)" />
            </div>
        </div>

        <div class="mb-3">
            <label>Dirección:</label>
            <div>
                <InputText class="form-control" @bind-Value="@institucion.Direccion" />
                <ValidationMessage For="@(() => institucion.Direccion)" />
            </div>
        </div>
        <div class="mb-3">
            <label>Estado:</label>
            <div>
                <select class="form-control" @bind="@institucion.Estado">
                    <option value="Activo">Activo</option>
                    <option value="Inactivo">Inactivo</option>
                </select>
            </div>
        </div>

        <button class="btn btn-primary" type="submit">Editar</button>
        <button class="btn btn-primary" @onclick="Cancelar">Cancelar</button>
    </EditForm>
}
else
{
    <p>Cargando...</p>
}

@code {
    private EditContext contextoEdicion;
    private Institucion institucion;

    [Parameter]
    public string rowKey { get; set; }

    protected override async Task OnInitializedAsync()
    {
        // Obtener la institución por su RowKey
        string token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c3VhcmlvIjoibWFyY28iLCJyb2wiOiJBZG1pbiIsImVzdGFkbyI6IkFjdGl2byIsImV4cCI6MTcxNDY5ODU1N30.MXG3tCUNsze-FNZo_E-2D7SJpOLPCclRbNvnbU1P4iY"; // Asegúrate de tener un token válido
        institucion = await servicioInstitucion.ObtenerInstitucionPorRowKey(rowKey, token);

        // Crear el EditContext si la institución se cargó correctamente
        if (institucion != null)
        {
            contextoEdicion = new EditContext(institucion);
        }
    }

    private async Task Editar()
    {
        // Lógica para editar la institución
        string token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c3VhcmlvIjoibWFyY28iLCJyb2wiOiJBZG1pbiIsImVzdGFkbyI6IkFjdGl2byIsImV4cCI6MTcxNDY5ODU1N30.MXG3tCUNsze-FNZo_E-2D7SJpOLPCclRbNvnbU1P4iY"; // Asegúrate de tener un token válido
        bool exito = await servicioInstitucion.EditarInstitucion(institucion, token);

        if (exito)
        {
            // Redirigir a la lista de instituciones después de editar
            nav.NavigateTo("/instituciones");
        }
        else
        {
            // Mostrar un mensaje de error si la edición falla
            await sweetAlertService.FireAsync("Error", "No se pudo editar la institución", SweetAlertIcon.Error);
        }
    }

    private void Cancelar()
    {
        // Redirigir a la lista de instituciones si se cancela la edición
        nav.NavigateTo("/instituciones");
    }
}
